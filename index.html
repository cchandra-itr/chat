<!doctype html>
<html lang=en>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Untitled Chat</title>
<script src=tailwindcss-3.4.16.js></script>
<style>::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:#1a1a1a;border-radius:10px}::-webkit-scrollbar-thumb{background:#4a4a4a;border-radius:10px}::-webkit-scrollbar-thumb:hover{background:#6a6a6a}body{font-family:Inter,sans-serif}.spinner{border:4px solid rgba(255,255,255,.3);border-top:4px solid #3498db;border-radius:50%;width:24px;height:24px;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}body.dark-theme{background-color:#030712;color:#f3f4f6}body.light-theme{background-color:#f9fafb;color:#1f2937}body.dark-theme .header-bg{background-color:#111827}body.light-theme .header-bg{background-color:#e5e7eb}body.dark-theme .header-title-color{color:#f3f4f6}body.light-theme .header-title-color{color:#1f2937}body.dark-theme .input-bg{background-color:#1f2937;color:#f3f4f6}body.light-theme .input-bg{background-color:#d1d5db;color:#1f2937}body.light-theme .input-bg::placeholder{color:#6b7280}body.dark-theme .gemini-message-bg{background-color:#1f2937;color:#f3f4f6}body.light-theme .gemini-message-bg{background-color:#e5e7eb;color:#1f2937}body.dark-theme .user-message-bg{background-color:#2563eb;color:#fff}body.light-theme .user-message-bg{background-color:#3b82f6;color:#fff}body.dark-theme .button-icon-color{color:#9ca3af}body.light-theme .button-icon-color{color:#4b5563}body.light-theme .hover-bg-gray-800:hover{background-color:#d1d5db}.markdown-content h1{font-size:1.875rem;font-weight:700;margin-bottom:.5rem}.markdown-content h2{font-size:1.5rem;font-weight:700;margin-bottom:.5rem}.markdown-content h3{font-size:1.25rem;font-weight:700;margin-bottom:.5rem}.markdown-content p{margin-bottom:.5rem}.markdown-content ul{list-style:disc;padding-left:1.5rem;margin-bottom:.5rem}.markdown-content ol{list-style:decimal;padding-left:1.5rem;margin-bottom:.5rem}.markdown-content li{margin-bottom:.25rem}.markdown-content b,.markdown-content strong{font-weight:700}.markdown-content em,.markdown-content i{font-style:italic}.markdown-content a{color:#3b82f6;text-decoration:underline}.markdown-content pre{background-color:rgba(0,0,0,.2);padding:.75rem;border-radius:.5rem;overflow-x:auto;margin-top:.5rem;margin-bottom:.5rem;font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace;font-size:.875rem;line-height:1.25;white-space:pre-wrap;word-wrap:break-word}body.light-theme .markdown-content pre{background-color:rgba(0,0,0,.1)}.markdown-content code:not(pre code){background-color:rgba(0,0,0,.1);padding:.125rem .375rem;border-radius:.25rem;font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace;font-size:.875rem}body.light-theme .markdown-content code:not(pre code){background-color:rgba(0,0,0,.05)}.markdown-content blockquote{border-left:4px solid #3b82f6;padding-left:1rem;margin-left:0;margin-bottom:.5rem;color:#9ca3af}body.light-theme .markdown-content blockquote{color:#6b7280}.markdown-content hr{border:none;border-top:1px solid #4a4a4a;margin:1rem 0}body.light-theme .markdown-content hr{border-top-color:#d1d5db}.unauthorized-screen{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;background-color:#030712;color:#f3f4f6;z-index:1000}.unauthorized-screen h1{font-size:3rem;font-weight:700;margin-bottom:1rem}.unauthorized-screen p{font-size:1.25rem;margin-bottom:2rem}.btn-disabled{opacity:.5;cursor:not-allowed}</style>
</head>
<body class="dark-theme h-screen flex overflow-hidden">
<main id=chat-container class="flex-1 flex flex-col">
<header id=chat-header class="header-bg p-4 flex items-center justify-between shadow-md">
<h2 id=chat-title class="text-xl font-semibold header-title-color">Chat</h2>
<div id=header-buttons class="flex items-center space-x-4">
<button id=summarize-chat-button class="px-3 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 transition-colors text-white text-sm flex items-center gap-1">
âœ¨ Summarize Chat
</button>
<button id=end-chat-button class="px-3 py-2 rounded-lg bg-red-600 hover:bg-red-700 transition-colors text-white text-sm flex items-center gap-1">
End Chat
</button>
<button id=theme-toggle class="p-2 rounded-full hover-bg-gray-800 transition-colors button-icon-color">
<svg id=sun-icon class="w-6 h-6" fill=none stroke=currentColor viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg style=display:block>
<path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.325 3.325l-.707.707M6.364 6.364l-.707-.707m12.728 0l-.707.707M6.364 17.636l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
</svg>
<svg id=moon-icon class="w-6 h-6" fill=none stroke=currentColor viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg style=display:none>
<path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
</svg>
</button>
</div>
</header>
<div id=chat-messages class="flex-1 p-6 overflow-y-auto space-y-6">
</div>
<div id=input-area class="p-4 header-bg flex items-center gap-2 shadow-inner">
<input id=chat-input placeholder="Ask me anything ..." class="flex-1 p-3 rounded-lg input-bg focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400">
<button id=send-button class="bg-blue-600 text-white p-3 rounded-full hover:bg-blue-700 transition-colors">
<svg class="w-6 h-6" fill=none stroke=currentColor viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
</button>
</div>
</main>
<div id=unauthorized-screen class="unauthorized-screen hidden">
<h1>401 Unauthorized</h1>
<p>Access Denied. Please ensure you have a valid token.</p>
</div>
<script>document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("chat-input"),t=document.getElementById("send-button"),n=document.getElementById("chat-messages"),s=document.getElementById("summarize-chat-button"),o=document.getElementById("end-chat-button"),l=document.getElementById("theme-toggle"),a=document.getElementById("sun-icon"),d=document.getElementById("moon-icon"),c=document.body,i=document.getElementById("input-area"),r=document.getElementById("header-buttons"),m=document.getElementById("chat-container"),u=document.getElementById("unauthorized-screen"),p=document.getElementById("chat-title");let g=[],h=!0,y=null;const b=sessionStorage.getItem("token"),v=new URLSearchParams(window.location.search),L=v.get("token"),w=v.get("title");if(L){sessionStorage.setItem("token",L),w&&sessionStorage.setItem("chatTitle",w);const e=window.location.origin+window.location.pathname;window.location.replace(e)}else{if(!b)return m.classList.add("hidden"),void u.classList.remove("hidden");{y=b;const a=sessionStorage.getItem("chatTitle")||"Untitled Chat";document.title=a,p.textContent=a,function(){g=[],n.innerHTML="",e.value="",E("Hello! There are some context info loaded, ready for your follow up questions."),document.getElementById("input-area")||document.querySelector("main").appendChild(i);document.getElementById("header-buttons")||document.getElementById("chat-header").appendChild(r);s.disabled=!1,s.classList.remove("btn-disabled"),o.disabled=!1,o.classList.remove("btn-disabled"),l.disabled=!1,l.classList.remove("btn-disabled"),t.disabled=!1,t.classList.remove("btn-disabled")}()}t.addEventListener("click",f),e.addEventListener("keypress",(e=>{"Enter"===e.key&&f()})),s.addEventListener("click",(async function(){e.value="Please provide a concise summary of our conversation.",f()})),o.addEventListener("click",(function(){g=[],n.innerHTML="",sessionStorage.clear(),i.parentNode&&i.parentNode.removeChild(i);r.parentNode&&r.parentNode.removeChild(r);const e=document.createElement("div");e.className="flex justify-center items-center h-full text-center text-gray-400",e.innerHTML='\n                    <div>\n                        <p class="text-xl font-semibold mb-2">Session Ended</p>\n                        <p>Thank you for your conversation. You can now close this window.</p>\n                    </div>\n                ',n.appendChild(e),n.scrollTop=n.scrollHeight,setTimeout((()=>{try{if(window.opener&&!window.opener.closed)window.close();else{console.warn("Could not close window automatically. User may need to close it manually.");const e=document.createElement("div");e.className="flex justify-center items-center text-center text-gray-400 mt-4",e.innerHTML='<p class="text-sm">If the window did not close automatically, please close it manually.</p>',n.appendChild(e),n.scrollTop=n.scrollHeight}}catch(e){console.error("Error attempting to close window:",e);const t=document.createElement("div");t.className="flex justify-center items-center text-center text-gray-400 mt-4",t.innerHTML='<p class="text-sm">An error occurred while trying to close the window. Please close it manually.</p>',n.appendChild(t),n.scrollTop=n.scrollHeight}}),3e4)})),l.addEventListener("click",(function(){h=!h,h?(c.classList.remove("light-theme"),c.classList.add("dark-theme"),a.style.display="block",d.style.display="none"):(c.classList.remove("dark-theme"),c.classList.add("light-theme"),a.style.display="none",d.style.display="block")}))}async function f(){const l=e.value.trim();if(""===l)return;!function(e){const t=document.createElement("div");t.className="flex justify-end",t.innerHTML=`\n                    <div class="user-message-bg p-3 rounded-lg max-w-xl shadow-md">\n                        ${e}\n                    </div>\n                `,n.appendChild(t),n.scrollTop=n.scrollHeight}(l),e.value="",t.disabled=!0,t.classList.add("btn-disabled"),s.disabled=!0,s.classList.add("btn-disabled"),o.disabled=!0,o.classList.add("btn-disabled"),e.disabled=!0,g.push({role:"user",parts:[{text:l}]});const a=function(){const e=document.createElement("div");return e.className="flex justify-start",e.innerHTML='\n                    <div class="gemini-message-bg p-3 rounded-lg max-w-xl shadow-md flex items-center space-x-2">\n                        <div class="spinner"></div>\n                        <span>I am thinking...</span>\n                    </div>\n                ',n.appendChild(e),n.scrollTop=n.scrollHeight,e}();n.scrollTop=n.scrollHeight;try{const l="https://socremus.cchandra.workers.dev/v1/chat/continue",d={"Content-Type":"application/json"};y&&(d.Authorization=`Bearer ${y}`);const c={contents:g},i=await fetch(l,{method:"POST",headers:d,body:JSON.stringify(c)}),r=await i.json();if(a.remove(),r.candidates&&r.candidates.length>0&&r.candidates[0].content&&r.candidates[0].content.parts&&r.candidates[0].content.parts.length>0){const e=r.candidates[0].content.parts[0].text;E(e),g.push({role:"model",parts:[{text:e}]})}else E("Error: Could not get a response from LLM. Please try again."),console.error("LLM API response structure unexpected:",r)}catch(e){a.remove(),E("Error: Failed to connect to LLM API. Please check your network or try again later."),console.error("Error calling LLM API:",e)}finally{t.disabled=!1,t.classList.remove("btn-disabled"),s.disabled=!1,s.classList.remove("btn-disabled"),o.disabled=!1,o.classList.remove("btn-disabled"),e.disabled=!1,n.scrollTop=n.scrollHeight}}function E(e){const t=document.createElement("div");t.className="flex justify-start";let s=e;s=s.replace(/```(\w+)?\n([\s\S]*?)```/g,((e,t,n)=>`<pre><code class="language-${t||""}">${n.trim()}</code></pre>`)),s=s.replace(/^### (.*$)/gm,"<h3>$1</h3>"),s=s.replace(/^## (.*$)/gm,"<h2>$1</h2>"),s=s.replace(/^# (.*$)/gm,"<h1>$1</h1>"),s=s.replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>"),s=s.replace(/^-{3,}\s*$/gm,"<hr>"),s=s.replace(/^\s*(\*|\-)\s+(.*)/gm,"::UL_ITEM::$2"),s=s.replace(/^\s*(\d+)\.\s+(.*)/gm,"::OL_ITEM::$2"),s=s.replace(/`([^`]+)`/g,"<code>$1</code>"),s=s.replace(/(\*\*|__)(.*?)\1/g,"<b>$2</b>"),s=s.replace(/(\*|_)(.*?)\1/g,"<em>$2</em>"),s=s.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>'),s=s.replace(/\n/g,"<br>"),s=s.replace(/::UL_ITEM::(.*?)(<br>|$)/g,"<li>$1</li>"),s=s.replace(/::OL_ITEM::(.*?)(<br>|$)/g,"<li>$1</li>"),s=s.replace(/(<li>.*?<\/li>(<br>)?)+/g,(e=>e.startsWith("<li>")?`<ul>${e.replace(/<br>/g,"")}</ul>`:e)),s.match(/^(<h|<ul|<ol|<pre|<blockquote|<hr)/i)||(s=`<p>${s}</p>`),s=s.replace(/(<\/li>|<pre><code>.*?<\/code><\/pre>|<br>)\s*<br>/g,"$1"),t.innerHTML=`\n                    <div class="gemini-message-bg p-3 rounded-lg max-w-xl shadow-md markdown-content">\n                        ${s}\n                    </div>\n                `,n.appendChild(t),n.scrollTop=n.scrollHeight}}))</script>
</body>
</html>
